# QEDMMA v3.1 - PRBS-20 Segmented Correlator Registers
# [REQ-CORR20-004] AXI-Lite register interface
# Author: Dr. Mladen Mešter
# Copyright (c) 2026

module:
  name: prbs20_segmented_correlator
  description: "Dual-Mode PRBS-15/20 Correlator - 60.2/86.8 dB Gain"
  base_address: 0x000E0000
  version: "3.1.0"

registers:
  - name: CTRL
    offset: 0x00
    access: RW
    reset: 0x00000000
    description: "Control Register"
    fields:
      - { name: enable,       bits: "0",   default: 0, desc: "Enable correlator" }
      - { name: prbs20_mode,  bits: "1",   default: 0, desc: "0=PRBS-15 (45.2dB), 1=PRBS-20 (60.2dB)" }
      - { name: start,        bits: "2",   default: 0, desc: "Start correlation (self-clearing)" }
      - { name: clear,        bits: "3",   default: 0, desc: "Clear accumulators" }
      - { name: continuous,   bits: "4",   default: 0, desc: "Continuous correlation mode" }

  - name: STATUS
    offset: 0x04
    access: RO
    description: "Status Register"
    fields:
      - { name: state,        bits: "3:0",   desc: "FSM: 0=IDLE,1=FILL,2=CORR,3=ACC,4=NEXT,5=OUT,6=DONE" }
      - { name: segment,      bits: "8:4",   desc: "Current segment (0-31)" }
      - { name: busy,         bits: "9",     desc: "Correlation in progress" }
      - { name: complete,     bits: "10",    desc: "Correlation complete" }
      - { name: overflow,     bits: "11",    desc: "Accumulator overflow" }
      - { name: buffer_full,  bits: "12",    desc: "Sample buffer full" }

  - name: SEED
    offset: 0x08
    access: RW
    reset: 0x000FFFFF
    description: "LFSR Seed"
    fields:
      - { name: value,        bits: "19:0", default: 0xFFFFF, desc: "20-bit LFSR initial state" }

  - name: THRESHOLD_LO
    offset: 0x0C
    access: RW
    reset: 0x00100000
    description: "Detection Threshold [31:0]"
    fields:
      - { name: value,        bits: "31:0", default: 0x100000, desc: "Lower 32 bits" }

  - name: THRESHOLD_HI
    offset: 0x10
    access: RW
    reset: 0x00000000
    description: "Detection Threshold [47:32]"
    fields:
      - { name: value,        bits: "15:0", default: 0, desc: "Upper 16 bits" }

  - name: CHIP_COUNT
    offset: 0x14
    access: RO
    description: "Chip Counter"
    fields:
      - { name: count,        bits: "31:0", desc: "Chips processed" }

  - name: DETECTION_CNT
    offset: 0x18
    access: RO
    description: "Detection Counter"
    fields:
      - { name: count,        bits: "15:0", desc: "Threshold crossings" }

  - name: LAST_DET_BIN
    offset: 0x1C
    access: RO
    description: "Last Detection Range Bin"
    fields:
      - { name: bin,          bits: "19:0", desc: "Range bin index (0-1048574)" }

  - name: LAST_DET_MAG_LO
    offset: 0x20
    access: RO
    description: "Last Detection Magnitude [31:0]"
    fields:
      - { name: value,        bits: "31:0", desc: "Magnitude low" }

  - name: LAST_DET_MAG_HI
    offset: 0x24
    access: RO
    description: "Last Detection Magnitude [47:32]"
    fields:
      - { name: value,        bits: "15:0", desc: "Magnitude high" }

  - name: PERF_CYCLES
    offset: 0x28
    access: RO
    description: "Performance: Clock Cycles per Correlation"
    fields:
      - { name: cycles,       bits: "31:0", desc: "Cycle count" }

  - name: GAIN_DB
    offset: 0x2C
    access: RO
    description: "Current Processing Gain (dB × 10)"
    fields:
      - { name: prbs_gain,    bits: "15:0", desc: "PRBS gain (452 or 602)" }
      - { name: total_gain,   bits: "31:16", desc: "Total system gain (803 or 868)" }

# Performance Specs (Grok-X Validated)
performance:
  prbs15_mode:
    code_length: 32767
    processing_gain_db: 45.2
    with_7_pulse_integration_db: 53.7
    quantum_gain_db: 18.2
    eccm_gain_db: 8.4
    total_system_gain_db: 80.3
    f35_range_km: 526
    update_rate_hz: 872
    bram_36kb: 42
    
  prbs20_mode:
    code_length: 1048575
    processing_gain_db: 60.2
    quantum_gain_db: 18.2
    eccm_gain_db: 8.4
    total_system_gain_db: 86.8
    f35_range_km: 769
    update_rate_hz: 191
    bram_36kb: 922
